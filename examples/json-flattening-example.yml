name: json-flattening-pipeline
sources:
  - type: kafka
    id: kafka-source
    brokers: localhost:9092
    group_id: rde-group-json-flatten
    topic: nested-data
    schema:
      auto_infer: true

transforms:
  # Flatten deeply nested JSON structures
  - type: json_flatten
    id: flatten-nested
    separator: "_"
    max_depth: 5
  
  # Clean the flattened data
  - type: clean_data
    id: clean-flattened
    remove_nulls: true
    trim_strings: true
    normalize_case: "lower"

sinks:
  - type: parquet_dir
    id: parquet-sink
    path: ./data/flattened

edges:
  - [kafka-source, flatten-nested]
  - [flatten-nested, clean-flattened]
  - [clean-flattened, parquet-sink]
